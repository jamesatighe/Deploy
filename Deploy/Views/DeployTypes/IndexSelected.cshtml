@model Deploy.ViewModel.TenantDeploys

@{
    ViewData["Title"] = "IndexSelected";
}

<h2>Deployment List</h2>
<p>
    You are currently working in company: <span style="font-weight:bold;font-size:20px;" >@Html.DisplayFor(Model => Model.TennantName)</span>
</p>

<p>
    <a asp-action="Create" asp-route-id ="@Model.TennantID" class="btn btn-success btn-lg">Create New</a>
    <a asp-action="CreateRedirect" class="btn btn-primary btn-lg"><span class="glyphicon glyphicon-triangle-left"></span> Back</a>
    @{
        var saveCount = 0;
        var deployCount = 0;

        for (var i = 0; i < Model.DeployTypes.Count(); i++)
        {
            if (Model.DeployTypes[i].DeploySaved == "Yes")
            {
                saveCount++;
            }
            if (Model.DeployTypes[i].DeployState != null)
            {
                deployCount++;
            }
        }
        if (saveCount == Model.DeployTypes.Count)
        {
             <a asp-action="DeployToAzureSolution" asp-controller="TennantParams" asp-route-id="@Model.TennantID" class="btn btn-danger btn-lg"><span class="glyphicon glyphicon-cloud-upload"></span> Deploy</a>
        }
        if (deployCount == Model.DeployTypes.Count)
        {
            <a asp-action="GetDeployAll" asp-controller="TennantParams" asp-route-id="@Model.TennantID" class="btn btn-info btn-lg"><span class="glyphicon glyphicon-check"></span> Check</a>

        }




     }
</p>
<table class="table">
    <thead>
        <tr>
                <th>
                    Deploy Name
                </th>
            <th>
                Tenant ID
            </th>
            <th>
                Tennant Name
            </th>
            <th>
                Saved
            </th>
            <th>
                Deployment State
            </th>
            <th>
                Deployment Result
            </th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model.DeployTypes) {
        <tr>
            <td>
                @if (!string.IsNullOrEmpty(item.DeployName))
                {
                    @Html.ActionLink(item.DeployName, "DeployParams", new { Id = item.DeployTypeID })
                }

            </td>
            <td>
                @Html.DisplayFor(modelItem => item.TennantID)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Tennants.TennantName)
            </td>
            <td>
                @if (item.DeploySaved == "Yes")
                {
                   <span class="glyphicon glyphicon-ok"></span>
                }
                else
                {
                    <span class="glyphicon glyphicon-remove"></span>
                }
            </td>
            <td>
                @if (!string.IsNullOrEmpty(item.DeployResult))
                {
                    @if (item.DeployResult.Contains("\"provisioningState\":\"Succeeded"))
                    {
                        <span class="glyphicon glyphicon-ok"><span style="font-family:'Segoe UI'; color:green"> Deployed</span></span>   
                    }
                    else
                    {
                        if (item.DeployResult.Contains("\"provisioningState\":\"Running"))
                        {
                            <span class="glyphicon glyphicon-refresh"><span style="font-family:'Segoe UI'; color:orange"> Running</span></span>
                        }
                        else
                        {
                            if (item.DeployResult.Contains("\"provisioningState\":\"Accepted"))
                            {
                                <span class="glyphicon glyphicon-thumbs-up"><span style="font-family:'Segoe UI'; color:darkgreen"> Accepted</span></span>
                            }
                            else
                            {
                                if (item.DeployResult.Contains("\"provisioningState\":\"Failed"))
                                {
                                    <span class="glyphicon glyphicon-warning-sign"><span style="font-family:'Segoe UI'; font-weight:bold; color:red"> Failed</span></span>
                                }

                            }
                        }

                    }
                }



                else
                {
                    @Html.DisplayFor(modelItem => item.DeployState)

                }
            </td>
            <td>
                @if (!string.IsNullOrEmpty(item.DeployResult))
                {
                @Html.ActionLink("Result", "DeployResults", new { Id = item.DeployTypeID })
                }
            </td>
            <td>
                <a asp-action="SaveToAzure" asp-controller="TennantParams" asp-route-id="@item.DeployTypeID" class="btn btn-success btn-default"><span class="glyphicon glyphicon-floppy-save"></span> Save to Azure</a>
                <a asp-action="Edit" asp-route-id="@item.DeployTypeID" class="btn btn-warning btn-default"><span class="glyphicon glyphicon-wrench"></span> Edit</a> 
                <a asp-action="Details" asp-route-id="@item.DeployTypeID"class="btn btn-primary btn-default"><span class="glyphicon glyphicon-list"></span> Details</a> 
                <a asp-action="Delete" asp-route-id="@item.DeployTypeID"class="btn btn-danger btn-default"><span class="glyphicon glyphicon-remove"></span> Delete</a>
            </td>
        </tr>
}
    </tbody>
</table>


